<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Making Queries - Grasshopper User Guide</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Grasshopper User Guide</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../installation/">Installation</a>
</li>

                        
                            
<li >
    <a href="../../configs/">Configuration</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Basic Concepts <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../concepts/app-auth/">App authentication</a>
</li>

                        
                            
<li >
    <a href="../../concepts/admin-ui/">The Admin UI</a>
</li>

                        
                            
<li >
    <a href="../../concepts/content/">Content / Content Types</a>
</li>

                        
                            
<li >
    <a href="../../concepts/assets/">Managing Assets</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Common Scenarios <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../user/">The User Object</a>
</li>

                        
                            
<li class="active">
    <a href="./">Making Queries</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../user/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li class="disabled">
                        <a rel="prev" >
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#queries">Queries</a></li>
        
            <li><a href="#filters">filters</a></li>
        
            <li><a href="#value">value</a></li>
        
            <li><a href="#types">types</a></li>
        
            <li><a href="#nodes">nodes</a></li>
        
            <li><a href="#options">options</a></li>
        
            <li><a href="#important-notes">Important Notes</a></li>
        
            <li><a href="#examples">Examples</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="queries">Queries</h1>
<p>Grasshopper's query builder accepts a query object that contains several parameters, some optional.</p>
<p>The returned object is an array with limit, skip and total. The total is the value of all content matched by query, not just returned objects.</p>
<p>Definitions for all possible query parameters/options</p>
<h2 id="filters">filters</h2>
<p>An array of optional filter objects for the query.</p>
<ul>
<li>key: The key of the content being filtered.</li>
<li>cmp: The comparison operator for the filter value. Currently supported operators (Query accepts symbol or string value):</li>
<li>'=': equals</li>
<li>'!=' or 'not' or 'notequal' or 'notequals': not equal to</li>
<li>'&gt;=' or 'gte': greater than or equals</li>
<li>'&gt;' or 'gt': great  ser than</li>
<li>'&lt;=' or 'lte': less than or equals</li>
<li>'&lt;' or 'lt': less than</li>
<li>'in' or 'contains': contains</li>
<li>'!in' or 'notin' or 'notcontains': does not contain</li>
<li>'%' or 'like': like (Allows for 'fuzzy matching')</li>
<li>'!%' or 'notlike': not like (Allows for 'fuzzy matching')</li>
<li>'between': between</li>
<li>'notbetween': not between</li>
<li>'size': size</li>
<li>'exists': exists</li>
</ul>
<h2 id="value">value</h2>
<p>Then value the filter will be compared with.</p>
<h2 id="types">types</h2>
<p>An optional array of content type ids.</p>
<h2 id="nodes">nodes</h2>
<p>An optional array of node ids.</p>
<h2 id="options">options</h2>
<p>Object. Possible key/value pairs are:</p>
<ul>
<li>limit : Limit number of results. String or number.</li>
<li>skip : Skip specified number of results. String or number. (limit and skip support pagination)</li>
<li>distinct : return distinct results within a find. Can include types.</li>
<li>exclude : array of fields to be excluded from query.</li>
<li>include : array of fields to be included in query.</li>
</ul>
<h2 id="important-notes">Important Notes</h2>
<p>The options object can have include or exclude parameters, but not both in the same query.
When using 'options.distinct', filters can't be used. This means paging is not available.</p>
<h2 id="examples">Examples</h2>
<p>In the following examples, "request" is the configured grasshopper request object</p>
<ol>
<li>Get a User with ID = {a valid ID}</li>
</ol>
<pre><code class="javascript">request
        .get()
        .users
        .query({
            filters: [
                {
                    key:'id',
                    cmp:'=',
                    value: {a valid ID}
                }
            ]
        })
</code></pre>

<ol>
<li>Get a list of users with the first name "Bob" and were created after 01-01-2016</li>
</ol>
<pre><code class="javascript"> request
        .get()
        .users
        .query({
            filters: [
                 {
                     key:'firstname',
                     cmp:'=',
                     value: 'Bob'
                 },
                 {
                     key: 'dateCreated',
                     cmp: '&gt;=',
                     value: new Date(2016,0,1,0,0,0,0)
                 }
             ]
        })
</code></pre>

<ol>
<li>Get a list of content items with node id {NODE-ID} and sort by meta.created in descending order and limit returned results to 100</li>
</ol>
<pre><code class="javascript"> request
        .get()
        .content
        .query({
             nodes : [{NODE-ID}],
             options : {
                 sort : {'meta.created': -1},
                 limit : 100
             }
        })
</code></pre>

<ol>
<li>Get a list of content items with node id {NODE-ID} with filters</li>
</ol>
<pre><code class="javascript"> request
        .get()
        .content
        .query({
            nodes: [{NODE-ID}],
            filters: [{
                key: 'contentField1',
                cmp: '=',
                value: ''
            }]
                })
</code></pre>

<ol>
<li>Get all pieces of content within a content type</li>
</ol>
<pre><code class="javascript">request.get()
       .content
       .query({
           types : [constants.servicePageContentTypeId]
       });
</code></pre>

<ol>
<li>Filter active blog posts, sort newest first, and paginate</li>
</ol>
<pre><code class="javascript">{
    types: [
        'blog-post-content-type-id'
    ],
    filters:[
        {
            key : 'fields.date',
            cmp : '&lt;',
            value : new Date()
        }
    ],
    options: {
        limit: 4,
        skip: 8,
        sortBy: {
            'fields.date': -1
        }
    }
}
</code></pre>

<ol>
<li>Optionally add year and category filters</li>
</ol>
<pre><code class="javascript">{
    key : 'fields.category',
    cmp : '=',
    value : 'business'
}
{
    key: 'fields.date',
    cmp: 'between',
    value: [
        new Date(2015, 0, 1, 0, 0, 0, 0),
        new Date(2015, 11, 31, 23, 59, 59, 999)
    ]
}
</code></pre>

<ol>
<li>Find all events in the future that are not featured and are not assigned to any of my teams, sorted by start date ascending. Donâ€™t include a bunch of the document fields in the response.</li>
</ol>
<pre><code class="javascript">app.ghCore.request(token.get()).content.query({
       nodes: ['551eb85bde9a59304b5164e0'],
       types: ['551eb735de9a59304b5164de'],
       filters: [
           { key: 'fields.dates.validTo', cmp: 'gte', value: new Date()},
           { key: 'fields.featured.value', cmp: 'eq', value: false},
           { key: 'fields.team', cmp: '!in', value: _.pluck(req.bridgetown.identity.profile.teams.concat(req.bridgetown.identity.profile.erns || []), 'id')}
       ],
       options: {
           skip: req.param('skip'),
           limit: req.param('limit'),
           sort: 'fields.dates.validFrom',
           exclude: [
               'fields.additioninformation',
               'fields.category',
               'fields.location',
               'fields.attendees',
               'fields.organizer',
               'fields.volunteeredhours',
               'fields.approved',
               'fields.eventfull',
               'fields.providetshirts',
               'fields.desiredvolunteers',
               'fields.isongoing',
               'fields.totalvolunteers'
           ],
       }
   });


</code></pre>

<ol>
<li>Get list of users with first or last name, "Flober"</li>
</ol>
<pre><code> request
        .get()
        .users
        .query({
            filters: [
                 {
                     key:['firstname', 'lastname'],
                     cmp:'=',
                     value: 'Flober'
                 }
             ]
        })
</code></pre>

<ol>
<li>Get list of users with first name starting with Fa</li>
</ol>
<pre><code> request
        .get()
        .users
        .query({
            filters: [
                 {
                     key:'firstname',
                     cmp:'%',
                     value: '^Fa'
                 }
             ]
        })
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
